#!/bin/bash
#
#   This file echoes a bunch of color codes to the 
#   terminal to demonstrate what's available.  Each 
#   line is the color code of one forground color,
#   out of 17 (default + 16 escapes), followed by a 
#   test use of that color on all nine background 
#   colors (default + 8 escapes).
#

FILE=".default"
F_ARG=
L_ARG=
ARG=
go (){
    while [ ! -z "$1" ] ; do
        if [ "$1" = "-l" ]; then
            L_ARG=1
        elif [ "$1" = "--" ]; then
            shift 
            ARG=("$@")
            return
        elif [ ! -z "$F_ARG" ]; then
            echo "Not a directory: `pwd`/$FILE"
            exit 1
        elif [ -f "$1" ]; then
            FILE=$1
            F_ARG=1
        elif [ -d "$1" ]; then 
            cd $1
        else
            echo "No such file or directory: `pwd`/$1"
            exit 1
        fi
        shift
    done
}

foo (){
    if [ -d "$1" ]; then
        cd $1
        foo ".default"
    elif [ -f "$1" ]; then
        chmod +x "`realpath $1`" 
        exec "`realpath $1`" "${ARG[@]}"
    else
        foo `find * | head -1`
    fi
}

DIR=`i colorscripts`
if [ -z "$DIR" ]; then 
    echo "You need to specify color script directory:"
    echo -e "\t$ git clone https://github.com/stark/Color-Scripts.git <dir>"
    echo -e "\t$ i colorscripts <dir>/color-scripts"
    exit 1
fi
cd $DIR

go "$@"
if [ ! -z "$L_ARG" ] && [ ! -z "$F_ARG" ]; then 
    echo "Not a directory: `pwd`/$FILE"
    exit 1
fi

if [ ! -z "$L_ARG" ] ; then
    find .
else
    foo $FILE
fi
exit
